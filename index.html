<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Annibal ‚Äì Louvre Museum AR</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #f0f0f0;
    }
    model-viewer {
      width: 100vw;
      height: 100vh;
      display: block;
    }
    
    /* Size control buttons */
    .size-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .size-btn {
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: white;
      padding: 12px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }
    
    .size-btn:hover {
      background: rgba(0, 0, 0, 0.9);
      transform: scale(1.1);
    }
    
    .size-btn:active {
      transform: scale(0.95);
    }
    
    /* Instructions overlay */
    .instructions {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 14px;
      text-align: center;
      z-index: 1000;
      display: none;
    }
    
    .instructions.show {
      display: block;
    }
  </style>
</head>
<body>

  <model-viewer
    src="annibal_-_louvre_museum.glb"
    ios-src="Annibal_-_Louvre_Museum.usdz"
    alt="Annibal ‚Äì Louvre Museum"
    ar
    ar-modes="webxr scene-viewer quick-look"
    ar-placement="floor"
    ar-tap-to-place="true"
    camera-controls
    auto-rotate
    shadow-intensity="1"
    shadow-softness="1"
    scale="0.3 0.3 0.3"
    ar-scale="fixed"
    loading="eager"
    reveal="auto"
    image-tracking
    ar-image-target="white-paper">
    
    <!-- AR Button -->
    <button slot="ar-button" id="ar-button">
      üèõÔ∏è View in AR
    </button>
    
  </model-viewer>

  <!-- Size Control Buttons -->
  <div class="size-controls">
    <button class="size-btn" id="size-up">+</button>
    <button class="size-btn" id="size-down">-</button>
    <button class="size-btn" id="size-reset">‚Üª</button>
  </div>

  <!-- Instructions -->
  <div class="instructions" id="instructions">
    üìÑ Point your camera at a white piece of paper to see the 3D model appear on it!
  </div>

  <!-- White Paper Target (hidden) -->
  <img id="white-paper" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+UGxhY2Ugb24gd2hpdGUgcGFwZXI8L3RleHQ+Cjwvc3ZnPg==" style="display: none;" alt="White Paper Target">

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const modelViewer = document.querySelector('model-viewer');
      const sizeUpBtn = document.getElementById('size-up');
      const sizeDownBtn = document.getElementById('size-down');
      const sizeResetBtn = document.getElementById('size-reset');
      const instructions = document.getElementById('instructions');
      
      let currentScale = 0.3; // Starting scale
      
      // Update model scale
      function updateScale(newScale) {
        currentScale = Math.max(0.1, Math.min(2.0, newScale)); // Limit between 0.1 and 2.0
        modelViewer.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
        console.log('Scale updated to:', currentScale);
      }
      
      // Size control buttons
      sizeUpBtn.addEventListener('click', function() {
        updateScale(currentScale + 0.1);
      });
      
      sizeDownBtn.addEventListener('click', function() {
        updateScale(currentScale - 0.1);
      });
      
      sizeResetBtn.addEventListener('click', function() {
        updateScale(0.3); // Reset to default
      });
      
      // Handle model loading
      modelViewer.addEventListener('load', function() {
        console.log('3D Model loaded successfully');
        updateScale(currentScale); // Apply initial scale
      });
      
      // Handle AR status changes
      modelViewer.addEventListener('ar-status', function(event) {
        console.log('AR Status:', event.detail.status);
        
        if (event.detail.status === 'presenting') {
          console.log('AR is active - point camera at white paper');
          instructions.classList.add('show');
        } else {
          instructions.classList.remove('show');
        }
      });
      
      // Handle image tracking
      modelViewer.addEventListener('image-tracking', function(event) {
        console.log('Image tracking status:', event.detail);
        
        if (event.detail.tracking) {
          console.log('White paper detected! Model should appear on paper.');
        } else {
          console.log('White paper not detected. Point camera at white paper.');
        }
      });
      
      // Handle errors
      modelViewer.addEventListener('error', function(event) {
        console.error('Model error:', event.detail);
      });
      
      // Touch gestures for pinch-to-zoom
      let initialDistance = 0;
      let initialScale = 0.3;
      
      modelViewer.addEventListener('touchstart', function(event) {
        if (event.touches.length === 2) {
          const touch1 = event.touches[0];
          const touch2 = event.touches[1];
          initialDistance = Math.sqrt(
            Math.pow(touch2.clientX - touch1.clientX, 2) +
            Math.pow(touch2.clientY - touch1.clientY, 2)
          );
          initialScale = currentScale;
        }
      });
      
      modelViewer.addEventListener('touchmove', function(event) {
        if (event.touches.length === 2) {
          event.preventDefault();
          const touch1 = event.touches[0];
          const touch2 = event.touches[1];
          const currentDistance = Math.sqrt(
            Math.pow(touch2.clientX - touch1.clientX, 2) +
            Math.pow(touch2.clientY - touch1.clientY, 2)
          );
          
          if (initialDistance > 0) {
            const scaleChange = currentDistance / initialDistance;
            const newScale = initialScale * scaleChange;
            updateScale(newScale);
          }
        }
      });
    });
  </script>

</body>
</html>
